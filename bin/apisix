#!/usr/bin/env lua

--
-- Licensed to the Apache Software Foundation (ASF) under one or more
-- contributor license agreements.  See the NOTICE file distributed with
-- this work for additional information regarding copyright ownership.
-- The ASF licenses this file to You under the Apache License, Version 2.0
-- (the "License"); you may not use this file except in compliance with
-- the License.  You may obtain a copy of the License at
--
--     http://www.apache.org/licenses/LICENSE-2.0
--
-- Unless required by applicable law or agreed to in writing, software
-- distributed under the License is distributed on an "AS IS" BASIS,
-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
-- See the License for the specific language governing permissions and
-- limitations under the License.
--

local ops  = require("apisix.cli.ops")
local etcd = require("apisix.cli.etcd")
local ver  = require("apisix.core.version")

local print = print


local function help()
    print([[
Usage: apisix [action] <argument>

help:       show this message, then exit
init:       initialize the local nginx.conf
init_etcd:  initialize the data of etcd
start:      start the apisix server
stop:       stop the apisix server
restart:    restart the apisix server
reload:     reload the apisix server
version:    print the version of apisix
]])
end


local function version()
    print(ver['VERSION'])
end


local command = {
    version = version,
    help = help,
    init = ops.init,
    init_etcd = etcd.init,
    start = ops.start,
    stop = ops.stop,
    restart = ops.restart,
    reload = ops.reload,
}

local action = arg[1]
if not action then
    return help()
end

if not command[action] then
    print("invalid argument: ", action, "\n")
    help()
    return
end

command[action](arg[2])
